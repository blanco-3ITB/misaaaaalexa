{"ast":null,"code":"import React,{useState,useRef}from'react';import api from'../utils/api';import'./Messenger.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const ProofCapture=()=>{const[selectedDeliveryId,setSelectedDeliveryId]=useState('');const[deliveries,setDeliveries]=useState([]);const[uploadedImage,setUploadedImage]=useState(null);const[loading,setLoading]=useState(false);const videoRef=useRef(null);const canvasRef=useRef(null);const fileInputRef=useRef(null);const[useCamera,setUseCamera]=useState(false);const handleFileSelect=e=>{const file=e.target.files[0];if(file){const reader=new FileReader();reader.onload=event=>{setUploadedImage(event.target.result);};reader.readAsDataURL(file);}};const startCamera=async()=>{try{const stream=await navigator.mediaDevices.getUserMedia({video:{facingMode:'environment'}});if(videoRef.current){videoRef.current.srcObject=stream;setUseCamera(true);}}catch(error){alert('Could not access camera: '+error.message);}};const capturePhoto=()=>{if(videoRef.current&&canvasRef.current){const context=canvasRef.current.getContext('2d');context.drawImage(videoRef.current,0,0,canvasRef.current.width,canvasRef.current.height);const imageData=canvasRef.current.toDataURL('image/jpeg');setUploadedImage(imageData);setUseCamera(false);if(videoRef.current.srcObject){videoRef.current.srcObject.getTracks().forEach(track=>track.stop());}}};const handleUploadProof=async()=>{if(!selectedDeliveryId||!uploadedImage){alert('Please select a delivery and capture/upload a photo');return;}try{setLoading(true);await api.post(\"/messenger/deliveries/\".concat(selectedDeliveryId,\"/proof\"),{imageData:uploadedImage});alert('Proof uploaded successfully!');setUploadedImage(null);setSelectedDeliveryId('');}catch(error){alert('Error uploading proof: '+error.message);}finally{setLoading(false);}};return/*#__PURE__*/_jsxs(\"div\",{className:\"messenger-container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"page-header\",children:[/*#__PURE__*/_jsx(\"h1\",{children:\"Upload Proof of Delivery\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Capture photo evidence of successful delivery\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"proof-form\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"form-section\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Select Delivery:\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Enter delivery ID or search\",value:selectedDeliveryId,onChange:e=>setSelectedDeliveryId(e.target.value),className:\"form-input\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-section\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Upload Photo:\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"upload-options\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"upload-btn camera\",onClick:startCamera,children:\"Use Camera\"}),/*#__PURE__*/_jsx(\"button\",{className:\"upload-btn gallery\",onClick:()=>{var _fileInputRef$current;return(_fileInputRef$current=fileInputRef.current)===null||_fileInputRef$current===void 0?void 0:_fileInputRef$current.click();},children:\"Upload from Gallery\"})]}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",ref:fileInputRef,onChange:handleFileSelect,accept:\"image/*\",style:{display:'none'}}),useCamera&&/*#__PURE__*/_jsxs(\"div\",{className:\"camera-section\",children:[/*#__PURE__*/_jsx(\"video\",{ref:videoRef,autoPlay:true,playsInline:true}),/*#__PURE__*/_jsx(\"canvas\",{ref:canvasRef,style:{display:'none'},width:\"640\",height:\"480\"}),/*#__PURE__*/_jsx(\"button\",{className:\"capture-btn\",onClick:capturePhoto,children:\"\\uD83D\\uDCF8 Capture\"})]}),uploadedImage&&/*#__PURE__*/_jsxs(\"div\",{className:\"image-preview\",children:[/*#__PURE__*/_jsx(\"img\",{src:uploadedImage,alt:\"Proof\"}),/*#__PURE__*/_jsx(\"p\",{children:\"\\u2713 Photo ready for upload\"})]})]}),/*#__PURE__*/_jsx(\"button\",{className:\"submit-btn\",onClick:handleUploadProof,disabled:loading||!selectedDeliveryId||!uploadedImage,children:loading?'Uploading...':'Upload Proof'})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"info-box\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Guidelines for Proof Capture:\"}),/*#__PURE__*/_jsxs(\"ul\",{children:[/*#__PURE__*/_jsx(\"li\",{children:\"Capture a clear photo of the delivery location\"}),/*#__PURE__*/_jsx(\"li\",{children:\"Include house/building number if visible\"}),/*#__PURE__*/_jsx(\"li\",{children:\"Ensure good lighting for clarity\"}),/*#__PURE__*/_jsx(\"li\",{children:\"Photo will be timestamped automatically\"}),/*#__PURE__*/_jsx(\"li\",{children:\"Maximum file size: 5MB\"})]})]})]});};export default ProofCapture;","map":{"version":3,"names":["React","useState","useRef","api","jsx","_jsx","jsxs","_jsxs","ProofCapture","selectedDeliveryId","setSelectedDeliveryId","deliveries","setDeliveries","uploadedImage","setUploadedImage","loading","setLoading","videoRef","canvasRef","fileInputRef","useCamera","setUseCamera","handleFileSelect","e","file","target","files","reader","FileReader","onload","event","result","readAsDataURL","startCamera","stream","navigator","mediaDevices","getUserMedia","video","facingMode","current","srcObject","error","alert","message","capturePhoto","context","getContext","drawImage","width","height","imageData","toDataURL","getTracks","forEach","track","stop","handleUploadProof","post","concat","className","children","type","placeholder","value","onChange","onClick","_fileInputRef$current","click","ref","accept","style","display","autoPlay","playsInline","src","alt","disabled"],"sources":["C:/pod system/frontend/src/pages/ProofCapture.js"],"sourcesContent":["import React, { useState, useRef } from 'react';\r\nimport api from '../utils/api';\r\nimport './Messenger.css';\r\n\r\nconst ProofCapture = () => {\r\n  const [selectedDeliveryId, setSelectedDeliveryId] = useState('');\r\n  const [deliveries, setDeliveries] = useState([]);\r\n  const [uploadedImage, setUploadedImage] = useState(null);\r\n  const [loading, setLoading] = useState(false);\r\n  const videoRef = useRef(null);\r\n  const canvasRef = useRef(null);\r\n  const fileInputRef = useRef(null);\r\n  const [useCamera, setUseCamera] = useState(false);\r\n\r\n  const handleFileSelect = (e) => {\r\n    const file = e.target.files[0];\r\n    if (file) {\r\n      const reader = new FileReader();\r\n      reader.onload = (event) => {\r\n        setUploadedImage(event.target.result);\r\n      };\r\n      reader.readAsDataURL(file);\r\n    }\r\n  };\r\n\r\n  const startCamera = async () => {\r\n    try {\r\n      const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } });\r\n      if (videoRef.current) {\r\n        videoRef.current.srcObject = stream;\r\n        setUseCamera(true);\r\n      }\r\n    } catch (error) {\r\n      alert('Could not access camera: ' + error.message);\r\n    }\r\n  };\r\n\r\n  const capturePhoto = () => {\r\n    if (videoRef.current && canvasRef.current) {\r\n      const context = canvasRef.current.getContext('2d');\r\n      context.drawImage(videoRef.current, 0, 0, canvasRef.current.width, canvasRef.current.height);\r\n      const imageData = canvasRef.current.toDataURL('image/jpeg');\r\n      setUploadedImage(imageData);\r\n      setUseCamera(false);\r\n      if (videoRef.current.srcObject) {\r\n        videoRef.current.srcObject.getTracks().forEach(track => track.stop());\r\n      }\r\n    }\r\n  };\r\n\r\n  const handleUploadProof = async () => {\r\n    if (!selectedDeliveryId || !uploadedImage) {\r\n      alert('Please select a delivery and capture/upload a photo');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      setLoading(true);\r\n      await api.post(`/messenger/deliveries/${selectedDeliveryId}/proof`, {\r\n        imageData: uploadedImage,\r\n      });\r\n      alert('Proof uploaded successfully!');\r\n      setUploadedImage(null);\r\n      setSelectedDeliveryId('');\r\n    } catch (error) {\r\n      alert('Error uploading proof: ' + error.message);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"messenger-container\">\r\n      <div className=\"page-header\">\r\n        <h1>Upload Proof of Delivery</h1>\r\n        <p>Capture photo evidence of successful delivery</p>\r\n      </div>\r\n\r\n      <div className=\"proof-form\">\r\n        <div className=\"form-section\">\r\n          <label>Select Delivery:</label>\r\n          <input \r\n            type=\"text\" \r\n            placeholder=\"Enter delivery ID or search\"\r\n            value={selectedDeliveryId}\r\n            onChange={(e) => setSelectedDeliveryId(e.target.value)}\r\n            className=\"form-input\"\r\n          />\r\n        </div>\r\n\r\n        <div className=\"form-section\">\r\n          <label>Upload Photo:</label>\r\n          \r\n          <div className=\"upload-options\">\r\n            <button className=\"upload-btn camera\" onClick={startCamera}>\r\n              Use Camera\r\n            </button>\r\n            <button className=\"upload-btn gallery\" onClick={() => fileInputRef.current?.click()}>\r\n              Upload from Gallery\r\n            </button>\r\n          </div>\r\n\r\n          <input \r\n            type=\"file\" \r\n            ref={fileInputRef} \r\n            onChange={handleFileSelect}\r\n            accept=\"image/*\"\r\n            style={{ display: 'none' }}\r\n          />\r\n\r\n          {useCamera && (\r\n            <div className=\"camera-section\">\r\n              <video ref={videoRef} autoPlay playsInline></video>\r\n              <canvas ref={canvasRef} style={{ display: 'none' }} width=\"640\" height=\"480\"></canvas>\r\n              <button className=\"capture-btn\" onClick={capturePhoto}>ðŸ“¸ Capture</button>\r\n            </div>\r\n          )}\r\n\r\n          {uploadedImage && (\r\n            <div className=\"image-preview\">\r\n              <img src={uploadedImage} alt=\"Proof\" />\r\n              <p>âœ“ Photo ready for upload</p>\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        <button \r\n          className=\"submit-btn\"\r\n          onClick={handleUploadProof}\r\n          disabled={loading || !selectedDeliveryId || !uploadedImage}\r\n        >\r\n          {loading ? 'Uploading...' : 'Upload Proof'}\r\n        </button>\r\n      </div>\r\n\r\n      <div className=\"info-box\">\r\n        <h3>Guidelines for Proof Capture:</h3>\r\n        <ul>\r\n          <li>Capture a clear photo of the delivery location</li>\r\n          <li>Include house/building number if visible</li>\r\n          <li>Ensure good lighting for clarity</li>\r\n          <li>Photo will be timestamped automatically</li>\r\n          <li>Maximum file size: 5MB</li>\r\n        </ul>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ProofCapture;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}